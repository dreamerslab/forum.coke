<hr />

<? it.title = 'Showing post'; ?>

<div class="post-content">
  <div>Post Author:
    <a href="/users/<?= it.post.as_user._id ;?>">
      <?= it.post.as_user.name ?>
    </a>
 </div>
  <div>Avatar: <img src="<?= it.post.as_user.avatar_link ?>" /></div>
  <div>Tags: <?= it.post.tag_names.join(', ') ?></div>
  <div>Title: <?= it.post.title ?></div>
  <div>Content: <?= it.post.content ?></div>
  <div>Modified: <?= new Date( it.post.updated_at ) ?></div>

  <? if( it.post.is_owner( it.sess_user )){ ?>
    <a href="/posts/<?= it.post._id ?>/edit">Edit the post</a>

    <form action="/posts/<?= it.post._id ?>" method="POST" accept-charset="UTF-8" >
      <input type="hidden" name="_method" value="delete" />
      <input type="hidden" name="_csrf" value="<?= it.csrf ?>" />
      <input class="submit-link" type="submit" value="Delete the post" />
    </form>
  <? }; ?>

  <hr />
  <div class="post-comments">
    <? it.post.comments.forEach( function ( comment ){ ?>
      <div>
        Commentor:
        <a href="/users/<?= comment.as_user._id ;?>">
          <?= comment.as_user.name ?>
        </a>
      </div>
      <div>Avatar: <img src="<?= comment.as_user.avatar_link ?>" /></div>
      <div>Content: <?= comment.content ?></div>
      <div>Modified: <?= new Date( comment.updated_at ) ?></div>
      <hr />
    <? }); ?>
  </div>

  <? if( it.sess_user ){ ?>
    <div class="new-comment">
      <h2> New comment </h2>
      <form action="/posts/<?= it.post._id ?>/comments" method="POST" accept-charset="UTF-8" >
        <div id="table">
          <input type="hidden" name="_csrf" value="<?= it.csrf ?>" />
          <div class="form-row">
            <label class="form-title" for="comment[content]">Content : </label><br />
            <textarea class="text-input" name="comment[content]" rows="10" cols="50"></textarea>
          </div>
        </div>
        <input class="submit-link" type="submit" value="Create comment" />
      </form>
    </div>
  <? } ?>
</div>